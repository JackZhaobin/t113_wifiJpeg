# JPEG流传输协议设计

## 协议概述
用于BusyBox端实时传输JPEG图片流（15fps）到WiFi客户端。

## 连接方式
- **传输层**：TCP Socket
- **端口**：8080（可配置）
- **连接模式**：长连接，持续传输

## 协议格式

### 帧格式
每帧JPEG图片的传输格式：

```
[帧头 8字节] + [JPEG数据 N字节]
```

### 帧头结构（8字节）
```
字节0-3: 帧序号 (uint32_t, 网络字节序)
字节4-7: JPEG数据长度 (uint32_t, 网络字节序)
```

### 数据格式
- **帧序号**：从0开始递增，用于检测丢帧
- **数据长度**：JPEG图片的字节数（最大建议2MB）
- **JPEG数据**：原始JPEG二进制数据

## 传输流程

### 1. 连接建立
```
客户端 -> 服务端: TCP连接 (IP:PORT)
服务端 -> 客户端: 发送欢迎消息（可选）
```

### 2. 数据流传输
```
服务端持续发送:
  [帧头8字节][JPEG数据]
  [帧头8字节][JPEG数据]
  ...
```

### 3. 错误处理
- 如果客户端断开，服务端检测到后停止发送
- 如果网络错误，客户端应重连

## 性能要求
- **帧率**：15fps（每帧约66ms）
- **延迟**：<100ms（端到端）
- **带宽**：取决于JPEG大小（假设每帧50KB，约6Mbps）

## 优化建议
1. **缓冲区**：服务端使用发送缓冲区，避免阻塞
2. **非阻塞IO**：使用select/poll避免阻塞
3. **分块发送**：大图片分块发送，避免一次性发送导致延迟
4. **帧率控制**：使用定时器精确控制15fps

